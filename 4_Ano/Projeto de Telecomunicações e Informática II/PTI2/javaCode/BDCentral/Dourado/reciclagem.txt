drop database if exists reciclagem;
create database reciclagem;
use reciclagem;

create table funcionario(
	codigo int NOT NULL AUTO_INCREMENT,
	nome varchar(20) NOT NULL,
	morada varchar(50),
	NIF varchar(9) NOT NULL,
	telefone char(9),
	data_nascimento date,
	data_contratacao date NOT NULL,
	data_terminacao date NULL,
	primary key(codigo)
);

create table viatura(
	matricula varchar(10) NOT NULL,
	tipo_viatura varchar(20) NOT NULL,
	kms int NOT NULL,
	primary key(matricula)
);

create table local_recolha(
	morada varchar(50) NOT NULL,
	telef_resp char(9) NOT NULL,
	nome_resp varchar(20),
	primary key(morada)
);

create table pedido_recolha(
	morada varchar(50) NOT NULL,
	data_pedido date NOT NULL,
	hora_pedido time NOT NULL,
	telef_resp char(9) NOT NULL,	
	informacao varchar(100),
	peso_recolha int NOT NULL,
	primary key(morada,data_pedido,hora_pedido),
	foreign key(morada) references local_recolha(morada)
);

create table rota(
	cod_rota int NOT NULL,
	primary key (cod_rota)
	);

create table itinerario(
	morada_inicial varchar(50) NOT NULL,
	morada_final varchar(50) NOT NULL,
	cod_rota int NOT NULL,
	distancia decimal(4,2) NOT NULL,
	primary key (morada_inicial,morada_final,cod_rota),
	foreign key (morada_inicial) references local_recolha(morada),
	foreign key (morada_final) references local_recolha(morada),
	foreign key (cod_rota) references rota(cod_rota)
	);


create table viagem(
	cod_rota int NOT NULL,
	matricula varchar(10) NOT NULL,
	data date NOT NULL,
	hora time NOT NULL,
	primary key (cod_rota,matricula,data,hora),
	foreign key (matricula) references viatura(matricula),
	foreign key (cod_rota) references rota(cod_rota)
	);


create table funcionarios_viagem(
	cod_rota int NOT NULL,
	cod_func int NOT NULL,
	foreign key (cod_rota) references rota(cod_rota),
	foreign key (cod_func) references funcionario(codigo)	
);

create table material(                    
	cod_lote int NOT NULL AUTO_INCREMENT,
	quantidade decimal(4,2) NOT NULL,
	tipo_material varchar(20) NOT NULL,
	preco_kg decimal(4,2) NOT NULL,
	data_eliminacao date NULL,
	primary key (cod_lote)             /*    */
);

create table venda(
	num_venda int NOT NULL AUTO_INCREMENT,
	cod_lote int NOT NULL,
	preco decimal(10,2) NULL,
	comprador VARCHAR(30) NOT NULL,
	primary key (num_venda),
	foreign key (cod_lote) references material(cod_lote)   /* */
);

create table processo(
	nome_processo varchar(20) NOT NULL,
	descricao varchar(100),
	primary key (nome_processo)
);

create table etapa(                               /*  */
	nome_processo varchar(20) NOT NULL,
	cod_func int NOT NULL,
	cod_lote int NOT NULL,
	data_etapa date NOT NULL,
	hora_inicio time,
	hora_fim time NULL,
	primary key(nome_processo,cod_func,cod_lote,data_etapa,hora_inicio),
	foreign key (nome_processo) references processo(nome_processo),
	foreign key(cod_func) references funcionario(codigo),
	foreign key(cod_lote) references material(cod_lote)
);







